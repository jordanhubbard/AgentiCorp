entitymetadata:
    schemaversion: ""
    attributes: {}
    migratedat: null
    migratedfrom: ""
id: loom-004
type: task
title: 'P0: Project-specific bead ID prefixes'
description: |-
    ## Problem
    Loom runtime hardcodes `bd-` prefix for all beads regardless of project. This causes:
    1. ID collisions when multiple projects are active
    2. Confusion about which project owns a bead
    3. Sync issues with bd CLI when projects have different prefixes

    ## Solution
    1. Read project prefix from `.beads/config.yaml` (issue-prefix field)
    2. If not set, derive from project ID (e.g., loom-self → acs-)
    3. Use project prefix when creating beads via API
    4. Update loom-self config with `issue-prefix: ac`
    5. Migrate existing beads to consistent prefix

    ## Acceptance Criteria
    - [ ] BeadsManager reads prefix from project config
    - [ ] New beads use project-specific prefix
    - [ ] loom-self uses `ac-` prefix
    - [ ] No ID collisions across projects
status: in_progress
priority: 2
projectid: loom-self
assignedto: agent-1769446210-Web Designer (Default)
blockedby: []
blocks: []
relatedto: []
parent: ""
children: []
tags: []
context:
    agent_id: agent-1769446210-Web Designer (Default)
    agent_output: |-
        We need to output strict JSON only, per instructions. Must be a single JSON object with "actions": [] and "notes": "". Provide plan, questions, next actions etc inside JSON. We need to follow format exactly: top-level object with "actions": array of action objects, and "notes": string. No extra text. Provide short plan etc? The output format says "Output format: 1) Short plan 2) Key questions/risks 3) Concrete next actions (commands/files to change) 4) Proposed patch snippets if applicable". But we must output JSON only. Within JSON we can include fields like "notes" that can contain the plan etc. But the required JSON structure only allows "actions" array and "notes". We can embed the plan etc in notes. The actions likely need to be specific commands: maybe read_file, write_file, etc. We need to implement steps: read .beads/config.yaml, maybe edit it, update config, maybe migrate beads? Probably we need to create a decision bead? The bead is already defined bd-004; we are working on it. We need to take actions to implement solution. Probably first read the config file. Then maybe write updated config. Then maybe update some code? Not sure code location. Might be in beads manager code. Could be under internal/beads or similar. Let's explore: The bead description mentions BeadsManager reads prefix from project config. So we may need to modify code to read config. We need to locate file. Use read_tree to find .beads/config.yaml? That's a file in project root. Also maybe code file: maybe internal/beads/manager.go? Let's search. Use read_tree? We can read directory. Let's start with read_tree path "." to see structure. Then maybe read .beads/config.yaml. Then maybe edit code.

        We need to output JSON with actions. Probably first action: read_file path ".beads/config.yaml". Then after reading, we can edit. But we can only output one JSON with actions. Could include multiple actions sequentially? The format allows array of actions; we can list multiple actions in order. We can include ask_followup? Probably we need to read config first. So action type read_file with path ".beads/config.yaml". Then maybe after reading, we can edit. But we need to provide content? The read_file action returns content? The system will execute and provide result? In this environment, we can issue read_file and then later act on content. Probably we need to issue read_file first. So output JSON with an action to read_file. Also maybe include notes with plan. Let's produce:

        {
          "actions": [
            {
              "type": "read_file",
              "path": ".beads/config.yaml",
              "question": "Read current config to check for issue-prefix field",
              "notes": "Plan: 1) Read .beads/config.yaml to see if issue-prefix is set. 2) If not, derive prefix from project ID (loom-self -> acs- or ac-?). 3) Update config with issue-prefix: ac. 4) Ensure BeadsManager uses this prefix. 5) Test bead creation."
            }
          ],
          "notes": "Short plan: read config, decide prefix, update config, adjust code to use prefix, migrate beads if needed. Risks: missing config field, migration errors. Next actions: read config, then edit config, then update code, then test."
        }

        But must follow exact JSON schema: each action object must have fields: type, question, path, content?, query?, patch?, max_depth, limit, command?, working_dir?, bead?, bead_id?, reason?, returned_to?. For read_file, required fields are path (yes) and maybe query? Actually spec: read_file requires path. It can also have "query"? Not needed. So we can include "path": ".beads/config.yaml". Also "question": "Read config". Also maybe "max_depth": 2? Not required but can include. We can include "limit": 100. Provide "type": "read_file". Also need "notes" field at top level.

        Thus produce JSON:

        {
          "actions": [
            {
              "type": "read_file",
              "path": ".beads/config.yaml",
              "question": "Read current config to check for issue-prefix field",
              "max_depth": 2,
              "limit": 100
            }
          ],
          "notes": "Short plan: 1) Read .beads/config.yaml to see if issue-prefix is defined. 2) If missing, derive prefix from project ID (e.g., loom-self -> acs- or ac-). 3) Write updated config with issue-prefix: ac. 4) Modify BeadsManager code to read this prefix and use it for bead IDs. 5) Create migration script to rename existing beads to new prefix. Risks: config may be missing or malformed; migration could affect existing beads. Next steps: read config, then edit it, then update manager code, then test."
        }

        Make sure JSON is valid, no trailing commas. Provide only that.
        </think>
        {
          "actions": [
            {
              "type": "read_file",
              "path": ".beads/config.yaml",
              "question": "Read current config to check for issue-prefix field",
              "max_depth": 2,
              "limit": 100
            }
          ],
          "notes": "Short plan: 1) Read .beads/config.yaml to determine if issue-prefix is set. 2) If not set, derive a project-specific prefix (e.g., loom-self → ac- or acs-). 3) Write the updated config with issue-prefix: ac. 4) Update BeadsManager code to read this prefix and prepend it to generated bead IDs. 5) Create and run a migration script to rename existing beads to the new prefix. Risks: config may be missing or malformed; migration could cause ID collisions if not handled carefully. Next concrete actions: read the config file, then edit it, then modify the relevant code, then test the prefix behavior."
        }
    agent_task_id: task-bd-004-1769449671927602087
    agent_tokens: "2800"
    agent_worker_id: worker-agent-1769446210-Web Designer (Default)-1769448672
    dispatch_history: '["agent-1769446210-Web Designer (Default)"]'
    last_run_at: "2026-01-26T17:48:20Z"
    loop_detected: "false"
    provider_id: sparky
    provider_model: nvidia/NVIDIA-Nemotron-3-Nano-30B-A3B-FP8
    redispatch_requested: "false"
duedate: null
milestoneid: ""
estimatedtime: 0
createdat: 2026-01-26T17:47:51.873914712Z
updatedat: 2026-01-26T17:48:20.045237128Z
closedat: null
