id: bd-070
type: feature
title: Secure provider credentials per user/team
description: |
  Enable users to have their own provider credentials and API keys, securely
  isolated from other users.
  
  COMPLETE:
  
  ✅ User-specific credential storage (internal/models/provider.go)
    - Added owner_id field to Provider model
    - Added is_shared field for shared providers
    - Providers can be owned by specific users or shared
  
  ✅ Database schema (internal/database/database.go)
    - Added owner_id column to providers table
    - Added is_shared column (defaults to true)
    - Migration: migrations_provider_ownership.go
    - Automatic migration on startup
  
  ✅ Credential isolation (internal/database/database.go)
    - ListProvidersForUser(userID) filters by owner/shared
    - Query: WHERE owner_id = ? OR is_shared = 1
    - Users see only their providers + shared providers
  
  ✅ Encryption at rest
    - Provider.KeyID references keymanager encrypted storage
    - API keys stored in auth.Manager with bcrypt hashing
    - Credentials never exposed in responses
  
  ✅ Multi-tenant security
    - Per-user provider filtering
    - Shared providers available to all
    - Owner-only providers isolated
    - Backwards compatible (NULL owner_id = shared)
  
  Note: Credential management UI can be added in future (bd-069 provides
  user management foundation). Provider registration already supports
  per-user credentials via owner_id field.

status: closed
priority: 1
project_id: agenticorp
assigned_to: claude
blocked_by:
  - bd-068
blocks: []
parent: bd-052
children: []
tags:
  - feature
  - security
  - credentials
  - multi-tenant
  - p1
created_at: 2026-01-20T00:00:00Z
updated_at: 2026-01-21T02:40:00Z
closed_at: 2026-01-21T02:40:00Z
context:
  source: product-manager future goals
  epic: bd-052
