id: bd-020
type: task
title: 'P2 - Tests: model-name parsing + negotiation ranking + scoring'
description: |
    Add tests to prevent regressions in model parsing and selection.

    Requirements
    - Unit tests for model-name parser:
      - verify correct extraction for:
        - Qwen/Qwen3-Coder-480B-A35B-Instruct ✓
        - Qwen/Qwen3-Coder-30B-A3B-Instruct ✓
        - nvidia/NVIDIA-Nemotron-3-Nano-30B-A3B-FP8 ✓
    - Unit tests for ranking/scoring logic (deterministic inputs) ✓
    - Unit tests for SelectBest negotiation logic ✓

    Implementation Summary
    - Created comprehensive test suite in internal/modelcatalog/catalog_test.go
    - Tests cover:
      * ParseModelName with 7 different model name formats
      * Score calculation with various interactivity/size combinations
      * SelectBest negotiation with multiple scenarios
      * Default catalog validation
      * Catalog Replace and Validate operations
    - Fixed parsing bug: models with active params (A35B) were incorrectly parsed
    - All 8 test functions pass with 31 test cases total

    Acceptance Criteria
    - ✓ Tests cover the required model names and negotiation behavior
    - ✓ All tests pass (go test ./internal/modelcatalog/...)
    - ✓ Build remains green

status: closed
priority: 2
projectid: ""
assignedto: agent-1768861966-decision-maker
blockedby: []
blocks: []
relatedto: []
parent: bd-014
children: []
tags:
    - p2
    - tests
    - models
    - providers
    - negotiation
context:
    agent_id: agent-1768861966-decision-maker
    dispatch_history: '["agent-1768861966-decision-maker"]'
    last_run_at: "2026-01-20T00:44:45Z"
    last_run_error: ''
    loop_detected: "false"
    provider_id: bootstrap-local
    redispatch_requested: "false"
    source: user-request
    completed_by: human-cursor-ai
createdat: 0001-01-01T00:00:00Z
updatedat: 2026-01-20T16:52:43Z
closedat: 2026-01-20T16:52:43Z
