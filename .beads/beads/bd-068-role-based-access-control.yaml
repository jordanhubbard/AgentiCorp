id: bd-068
type: feature
title: Implement role-based access control (admin, user, read-only)
description: |
  Add RBAC system with granular permissions for different user roles.
  
  VERIFIED COMPLETE:
  
  ✅ Role schema defined (internal/auth/models.go)
    - admin: Full system access (*:*)
    - user: Read/write access to most resources
    - viewer: Read-only access
    - service: API key-specific permissions
  
  ✅ Permission checking middleware (internal/auth/middleware.go)
    - Middleware(requiredPermission) function
    - HasPermission() with wildcard support
    - Checks both JWT claims and API key permissions
  
  ✅ Role assignment to users (internal/auth/manager.go)
    - CreateUser() with role parameter
    - Users have Role field
    - Permissions loaded from PreDefinedRoles
  
  ✅ Endpoints protected by roles
    - POST /api/v1/auth/users - admin only (line 131)
    - GET /api/v1/auth/users - admin only (line 168)  
    - Returns 403 for insufficient permissions (line 70, 40)
  
  ✅ Role management API (internal/auth/handlers.go)
    - HandleCreateUser() checks admin role
    - HandleListUsers() checks admin role
    - Roles enforced via GetRoleFromRequest()
  
  ✅ Permission system (internal/auth/models.go)
    - Granular permissions: agents:read, beads:write, etc.
    - Resource-based: agents, beads, providers, projects, decisions
    - Action-based: read, write, delete, admin
    - Wildcard support: *:*, agents:*

status: closed
priority: 1
project_id: agenticorp
assigned_to: claude
blocked_by:
  - bd-066
  - bd-067
blocks:
  - bd-069
parent: bd-052
children: []
tags:
  - feature
  - authorization
  - rbac
  - p1
created_at: 2026-01-20T00:00:00Z
updated_at: 2026-01-21T02:30:00Z
closed_at: 2026-01-21T02:30:00Z
context:
  source: product-manager future goals
  epic: bd-052
